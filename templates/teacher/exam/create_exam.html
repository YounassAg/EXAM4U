{% extends 'base.html' %}

{% block title %}Create Exam - Exam4U{% endblock %}

{% block content %}
<div class="flex min-h-screen">
    {% include 'components/teacher_sidebar.html' %}

    <div class="flex-1 space-y-8 p-8">
        <!-- Title Section -->
        <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/30 to-purple-500/30 rounded-2xl blur-xl"></div>
            <div class="relative backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/10">
                <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                    Create New Exam
                </h1>
                <p class="text-blue-200 mt-2">Set up your exam details and questions</p>
            </div>
        </div>

        <!-- Form Section -->
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="relative">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl blur-xl"></div>
                <div class="relative backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/10 space-y-6">
                    <!-- Basic Info Section -->
                    <div>
                        <label for="title" class="block text-sm font-medium text-blue-200 mb-2">Exam Title</label>
                        <input type="text" name="title" id="title" required 
                               class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-blue-200 mb-2">Description</label>
                        <textarea name="description" id="description" rows="3" 
                                  class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all"></textarea>
                    </div>

                    <div>
                        <label for="course" class="block text-sm font-medium text-blue-200 mb-2">Course</label>
                        <select name="course" id="course" required 
                                class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all [&>option]:bg-gray-900 [&>option]:text-white">
                            {% for course in courses %}
                                <option value="{{ course.id }}" class="bg-gray-900 text-white">{{ course.title }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div>
                        <label for="group" class="block text-sm font-medium text-blue-200 mb-2">Group</label>
                        <select name="group" id="group" required 
                                class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all [&>option]:bg-gray-900 [&>option]:text-white">
                            {% for group in groups %}
                                <option value="{{ group.id }}" class="bg-gray-900 text-white">{{ group }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="duration" class="block text-sm font-medium text-blue-200 mb-2">Duration (minutes)</label>
                            <input type="number" name="duration" id="duration" required 
                                   class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                        </div>

                        <div>
                            <label for="max_attempts" class="block text-sm font-medium text-blue-200 mb-2">Max Attempts</label>
                            <input type="number" name="max_attempts" id="max_attempts" value="1" required 
                                   class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                        </div>

                        <div>
                            <label for="start_date" class="block text-sm font-medium text-blue-200 mb-2">Start Date</label>
                            <input type="datetime-local" name="start_date" id="start_date" required 
                                   class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                        </div>

                        <div>
                            <label for="end_date" class="block text-sm font-medium text-blue-200 mb-2">End Date</label>
                            <input type="datetime-local" name="end_date" id="end_date" required 
                                   class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Section -->
            <div id="questions-container" class="space-y-6">
                <!-- Questions will be added here dynamically -->
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4">
                <button type="button" id="add-question" class="group relative flex-1">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg blur opacity-60 group-hover:opacity-100 transition duration-200"></div>
                    <div class="relative px-6 py-3 bg-black rounded-lg leading-none flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        <span class="text-white font-semibold">Add Question</span>
                    </div>
                </button>

                <button type="submit" class="group relative flex-1">
                    <div class="absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg blur opacity-60 group-hover:opacity-100 transition duration-200"></div>
                    <div class="relative px-6 py-3 bg-black rounded-lg leading-none flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span class="text-white font-semibold">Create Exam</span>
                    </div>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    let questionCount = 0;

    document.getElementById('add-question').addEventListener('click', function() {
        questionCount++;
        const questionContainer = document.createElement('div');
        questionContainer.classList.add('relative');
        questionContainer.innerHTML = `
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl blur-xl"></div>
            <div class="relative backdrop-blur-xl bg-white/10 rounded-2xl p-8 border border-white/10">
                <h3 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-4">Question ${questionCount}</h3>
                <div class="space-y-4">
                    <div>
                        <label for="question_type_${questionCount}" class="block text-sm font-medium text-blue-200 mb-2">Question Type</label>
                        <select name="question_type_${questionCount}" id="question_type_${questionCount}" required 
                                class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all [&>option]:bg-gray-900 [&>option]:text-white"
                                onchange="toggleMCQChoices(${questionCount})">
                            <option value="MCQ" class="bg-gray-900 text-white">Multiple Choice Question</option>
                            <option value="open" class="bg-gray-900 text-white">Open Question</option>
                            <option value="short_answer" class="bg-gray-900 text-white">Short Answer</option>
                        </select>
                    </div>
                    <div>
                        <label for="question_wording_${questionCount}" class="block text-sm font-medium text-blue-200 mb-2">Question Wording</label>
                        <textarea name="question_wording_${questionCount}" id="question_wording_${questionCount}" rows="3" required 
                                  class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all"></textarea>
                    </div>
                    <div>
                        <label for="question_points_${questionCount}" class="block text-sm font-medium text-blue-200 mb-2">Points</label>
                        <input type="number" name="question_points_${questionCount}" id="question_points_${questionCount}" value="1" required 
                               class="w-full px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                    </div>
                    <div id="mcq_choices_${questionCount}">
                        <label class="block text-sm font-medium text-blue-200 mb-2">MCQ Choices</label>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <input type="text" name="mcq_choice_${questionCount}_1" placeholder="Choice 1" 
                                       class="flex-1 px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                                <label class="inline-flex items-center space-x-2 text-blue-200">
                                    <input type="checkbox" name="mcq_correct_${questionCount}_1" 
                                           class="rounded border-white/10 bg-white/5 text-indigo-500 focus:ring-indigo-500">
                                    <span>Correct</span>
                                </label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="text" name="mcq_choice_${questionCount}_2" placeholder="Choice 2" 
                                       class="flex-1 px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
                                <label class="inline-flex items-center space-x-2 text-blue-200">
                                    <input type="checkbox" name="mcq_correct_${questionCount}_2" 
                                           class="rounded border-white/10 bg-white/5 text-indigo-500 focus:ring-indigo-500">
                                    <span>Correct</span>
                                </label>
                            </div>
                        </div>
                        <button type="button" onclick="addMCQChoice(${questionCount})" 
                                class="mt-4 group relative inline-flex items-center">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg blur opacity-60 group-hover:opacity-100 transition duration-200"></div>
                            <div class="relative px-4 py-2 bg-black rounded-lg leading-none flex items-center space-x-2">
                                <svg class="w-4 h-4 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                                <span class="text-white text-sm">Add Choice</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('questions-container').appendChild(questionContainer);
    });

    function toggleMCQChoices(questionNumber) {
        const questionType = document.getElementById(`question_type_${questionNumber}`).value;
        const mcqChoices = document.getElementById(`mcq_choices_${questionNumber}`);
        mcqChoices.style.display = questionType === 'MCQ' ? 'block' : 'none';
    }

    function addMCQChoice(questionNumber) {
        const mcqChoices = document.getElementById(`mcq_choices_${questionNumber}`);
        const choiceCount = mcqChoices.querySelectorAll('input[type="text"]').length + 1;
        const newChoice = document.createElement('div');
        newChoice.classList.add('flex', 'items-center', 'space-x-2', 'mt-2');
        newChoice.innerHTML = `
            <input type="text" name="mcq_choice_${questionNumber}_${choiceCount}" placeholder="Choice ${choiceCount}" 
                   class="flex-1 px-4 py-3 rounded-lg bg-white/5 border border-white/10 text-white placeholder-white/50 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 focus:outline-none transition-all">
            <label class="inline-flex items-center space-x-2 text-blue-200">
                <input type="checkbox" name="mcq_correct_${questionNumber}_${choiceCount}" 
                       class="rounded border-white/10 bg-white/5 text-indigo-500 focus:ring-indigo-500">
                <span>Correct</span>
            </label>
        `;
        mcqChoices.querySelector('.space-y-2').appendChild(newChoice);
    }
</script>
{% endblock %}